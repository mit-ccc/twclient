<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>twclient.models &mdash; twclient 0.2.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> twclient
          </a>
              <div class="version">
                0.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/readme.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/license.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vignettes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vignettes/fetch.html">Getting data from the Twitter API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vignettes/extract.html">Working with fetched data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../apidocs.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">twclient</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>twclient.models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for twclient.models</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">The database schema for storing Twitter data.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sa</span>
<span class="kn">import</span> <span class="nn">sqlalchemy.sql.functions</span> <span class="k">as</span> <span class="nn">func</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">BigInteger</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">UnicodeText</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">TIMESTAMP</span>  <span class="c1"># recommended over DateTime for TZs</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">Float</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">as_declarative</span><span class="p">,</span> <span class="n">declared_attr</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Index</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">UniqueConstraint</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_utils</span> <span class="k">as</span> <span class="n">ut</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Better to have these all in one file</span>
<span class="c1"># pylint: disable=too-many-lines</span>

<span class="c1"># Not applicable: database tables have lots of columns</span>
<span class="c1"># pylint: disable=too-many-instance-attributes</span>

<span class="c1"># This isn&#39;t a great way to handle these warnings, but sqlalchemy is so dynamic</span>
<span class="c1"># that most attribute accesses aren&#39;t resolved until runtime</span>
<span class="c1"># pylint: disable=no-member</span>

<span class="c1">#</span>
<span class="c1"># Base classes and infra</span>
<span class="c1">#</span>


<span class="nd">@as_declarative</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The base class for sqlalchemy models.</span>

<span class="sd">    This class provides some common functionality for sqlalchemy models in</span>
<span class="sd">    twclient, including a common table name format.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-self-argument</span>
        <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">split_camel_case</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">):</span>
        <span class="n">field_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">at_least_one_attached_attribute</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">field_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">field</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">sa</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">DetachedInstanceError</span><span class="p">:</span>
                <span class="n">field_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">=DetachedInstanceError&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">at_least_one_attached_attribute</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">at_least_one_attached_attribute</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_strings</span><span class="p">)</span><span class="si">}</span><span class="s2">)&gt;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr</span><span class="p">(</span><span class="o">**</span><span class="n">fields</span><span class="p">)</span>


<span class="c1"># This is from one of the standard sqlalchemy recipes:</span>
<span class="c1">#     https://github.com/sqlalchemy/sqlalchemy/wiki/UniqueObject</span>
<div class="viewcode-block" id="UniqueMixin"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UniqueMixin">[docs]</a><span class="k">class</span> <span class="nc">UniqueMixin</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Provide a merge-like operation by unique constraint instead of primary key.</span>

<span class="sd">    This class provides an analogue of Session.merge that works on any</span>
<span class="sd">    candidate key (set of jointly unique and not null columns) rather than just</span>
<span class="sd">    a primary key. The `as_unique` method either a) returns a persistent</span>
<span class="sd">    instance of the model if a row with the given unique key values already</span>
<span class="sd">    exists or b) creates a new one and adds it to the session.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># NOTE this is a mutable class attribute - all instances share it.</span>
    <span class="c1"># Probably this would pose garbage collection issues in a long-lived</span>
    <span class="c1"># application, but here we don&#39;t care.</span>
    <span class="n">_unique_caches</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># As in TimestampsMixin, hack to put the columns at the end in tables,</span>
    <span class="c1"># which declaring them as class attributes doesn&#39;t</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">unique_hash</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-self-argument</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A hash to implement a unique constraint without length limits.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># SHA-1 hashes in hex message digest format are 40 chars</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_make_hash</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">])</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<div class="viewcode-block" id="UniqueMixin.as_unique"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UniqueMixin.as_unique">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">as_unique</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return an instance of a model, uniquely with respect to a DB session.</span>

<span class="sd">        The `as_unique` method either a) returns a persistent instance of the</span>
<span class="sd">        class cls if a row with the column values given in kwargs already</span>
<span class="sd">        exists or b) creates a new one, adds it to the session and returns the</span>
<span class="sd">        newly pending object. The keyword arguments should specify column names</span>
<span class="sd">        and their values, and should uniquely identify a particular row. If a</span>
<span class="sd">        unique constraint does not exist on the columns, this function may or</span>
<span class="sd">        may not work correctly and will be quite slow.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        session : instance of sqlalchemy.orm.session.Session</span>
<span class="sd">            A sqlalchemy database session.</span>

<span class="sd">        **kwargs</span>
<span class="sd">            Keyword arguments which should uniquely identify a database row.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Instance of UniqueMixin</span>
<span class="sd">            Instance of the model implementing this API.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_caches</span><span class="p">[</span><span class="n">session</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_caches</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unique_caches</span><span class="p">[</span><span class="n">session</span><span class="p">]</span>

        <span class="n">uhash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_make_hash</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uhash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">no_autoflush</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">unique_hash</span><span class="o">=</span><span class="n">uhash</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">unique_hash</span><span class="o">=</span><span class="n">uhash</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="n">obj</span></div></div>


<span class="c1"># The @declared_attr is a bit of a hack - it puts the columns at the end in</span>
<span class="c1"># tables, which declaring them as class attributes doesn&#39;t</span>
<div class="viewcode-block" id="TimestampsMixin"><a class="viewcode-back" href="../../apidocs.html#twclient.models.TimestampsMixin">[docs]</a><span class="k">class</span> <span class="nc">TimestampsMixin</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add creation and modification timestamps to a model.</span>

<span class="sd">    This mixin adds insert_dt and modified_dt columns, and logic to update</span>
<span class="sd">    them, to classes descending from it. Nothing else needs to be done in</span>
<span class="sd">    subclasses to add these columns.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">insert_dt</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-self-argument</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The load time of the row into the database.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                      <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">modified_dt</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-self-argument</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The last time the row was modified. Note that this field is updated by</span>
<span class="sd">        application logic rather than a trigger.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                      <span class="n">onupdate</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="FromTweepyInterface"><a class="viewcode-back" href="../../apidocs.html#twclient.models.FromTweepyInterface">[docs]</a><span class="k">class</span> <span class="nc">FromTweepyInterface</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A model class capable of instantiating itself from a tweepy object.</span>

<span class="sd">    Classes implementing this interface provide a from_tweepy method which</span>
<span class="sd">    takes a tweepy object and optionally a sqlalchemy database session, and</span>
<span class="sd">    returns the instance of the class represented by the tweepy object.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Subclasses are expected to provide this logic, and the implementation</span>
    <span class="c1"># here is an abstract stub that raises NotImplementedError.</span>
<div class="viewcode-block" id="FromTweepyInterface.from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.FromTweepyInterface.from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Instantiate a class instance from a tweepy object.</span>

<span class="sd">        This method constructs a class instance from a tweepy object. A</span>
<span class="sd">        sqlalchemy database session is optional in general but may be required</span>
<span class="sd">        by some subclasses which rely on UniqueMixin.as_unique.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : instance of tweepy.Model</span>
<span class="sd">            The tweepy object to use as data source.</span>

<span class="sd">        session : instance of sqlalchemy.orm.session.Session, or None</span>
<span class="sd">            A sqlalchemy database session.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Instance of FromTweepyInterface</span>
<span class="sd">            The constructed class instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="ListFromTweepyInterface"><a class="viewcode-back" href="../../apidocs.html#twclient.models.ListFromTweepyInterface">[docs]</a><span class="k">class</span> <span class="nc">ListFromTweepyInterface</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A model class capable of instantiating multiple instances of itself from a</span>
<span class="sd">    tweepy object.</span>

<span class="sd">    Classes implementing this interface provide a list_from_tweepy method which</span>
<span class="sd">    takes a tweepy object and optionally a sqlalchemy database session, and</span>
<span class="sd">    returns the list of instances of the class which the tweepy object</span>
<span class="sd">    represents.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="ListFromTweepyInterface.list_from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.ListFromTweepyInterface.list_from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a list of class instances from a tweepy object.</span>

<span class="sd">        This method constructs multiple class instances from a tweepy object. A</span>
<span class="sd">        sqlalchemy database session is optional in general but may be required</span>
<span class="sd">        by some subclasses which rely on UniqueMixin.as_unique. Subclasses are</span>
<span class="sd">        expected to provide this logic, and the implementation here is an</span>
<span class="sd">        abstract stub that raises NotImplementedError.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : instance of tweepy.Model</span>
<span class="sd">            The tweepy object to use as data source.</span>

<span class="sd">        session : instance of sqlalchemy.orm.session.Session, or None</span>
<span class="sd">            A sqlalchemy database session.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List of instances of FromTweepyInterface</span>
<span class="sd">            The constructed class instances.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>


<span class="c1"># Store the creating package version in the DB to enable migrations (we don&#39;t</span>
<span class="c1"># actually do any migrations or have any code to support them yet, but if this</span>
<span class="c1"># isn&#39;t here to begin with it&#39;ll be a gigantic pain)</span>
<div class="viewcode-block" id="SchemaVersion"><a class="viewcode-back" href="../../apidocs.html#twclient.models.SchemaVersion">[docs]</a><span class="k">class</span> <span class="nc">SchemaVersion</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A stub table to store the schema version.</span>

<span class="sd">    This table contains one row with the version of twclient which created the</span>
<span class="sd">    database. This version string is stored to support future migrations,</span>
<span class="sd">    though none are supported now.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    version</span>
<span class="sd">        The creating package version.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">version</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<span class="c1">#</span>
<span class="c1"># Users, user tags and Twitter lists</span>
<span class="c1">#</span>


<div class="viewcode-block" id="User"><a class="viewcode-back" href="../../apidocs.html#twclient.models.User">[docs]</a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">FromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A Twitter user.</span>

<span class="sd">    This class and its associated user table represent attributes of a Twitter</span>
<span class="sd">    user which can&#39;t change over time. In practice, that means only user IDs -</span>
<span class="sd">    even screen names can change. See the UserData class and its user_data</span>
<span class="sd">    table for records of these mutable attributes.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    user_id</span>
<span class="sd">        The Twitter user ID for this user. This ID is assigned at account</span>
<span class="sd">        creation and is stable for the lifetime of the account.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># this is the Twitter user id, not a surrogate key.</span>
    <span class="c1"># it simplifies the load process to use it as a pk.</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;UserData&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">lists_owned</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;List&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;owning_user&#39;</span><span class="p">)</span>
    <span class="n">list_memberships</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;UserList&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tag&#39;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">UserTag</span><span class="o">.</span><span class="n">__table__</span><span class="p">,</span>
                        <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
    <span class="n">tweets</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;UserMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="User.from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.User.from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StgUser"><a class="viewcode-back" href="../../apidocs.html#twclient.models.StgUser">[docs]</a><span class="k">class</span> <span class="nc">StgUser</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A staging table for pulling exports.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="UserData"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UserData">[docs]</a><span class="k">class</span> <span class="nc">UserData</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">FromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Mutable attributes of a Twitter user.</span>

<span class="sd">    This class and its associated user_data table represent records of a</span>
<span class="sd">    Twitter user&#39;s mutable attributes. Many API requests to Twitter send back</span>
<span class="sd">    user entities with various properties of a user, including things from</span>
<span class="sd">    screen names and verified status to follower counts; we store these</span>
<span class="sd">    entities here.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    user_data_id</span>
<span class="sd">        An autoincrement ID for this fetch, not assigned by Twitter.</span>

<span class="sd">    user_id</span>
<span class="sd">        Twitter&#39;s user ID.</span>

<span class="sd">    url_id</span>
<span class="sd">        The user&#39;s profile URL (see the Url class).</span>

<span class="sd">    api_response</span>
<span class="sd">        The raw json text returned by Twitter.</span>

<span class="sd">    screen_name</span>
<span class="sd">        The user&#39;s screen name (note that this can change over time).</span>

<span class="sd">    create_dt</span>
<span class="sd">        The date and time the account was created.</span>

<span class="sd">    protected</span>
<span class="sd">        Does this account have protected tweets?</span>

<span class="sd">    verified</span>
<span class="sd">        Is this user verified?</span>

<span class="sd">    display_name</span>
<span class="sd">        The user&#39;s display name (not the screen name).</span>

<span class="sd">    description</span>
<span class="sd">        The user&#39;s bio text.</span>

<span class="sd">    location</span>
<span class="sd">        The user-provided free-form location field.</span>

<span class="sd">    friends_count</span>
<span class="sd">        The number of friends the user has (i.e., the number of other users</span>
<span class="sd">        they follow).</span>

<span class="sd">    followers_count</span>
<span class="sd">        The number of followers the user has.</span>

<span class="sd">    listed_count</span>
<span class="sd">        The number of lists the user appears on.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">user_data_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.user_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">url_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                    <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;url.url_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">api_response</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">screen_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">create_dt</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">protected</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">verified</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">friends_count</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">followers_count</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">listed_count</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Url&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;user_data&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_user_url</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">][</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;expanded_url&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">][</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;display_url&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">][</span><span class="s1">&#39;urls&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">url</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">url</span>

<div class="viewcode-block" id="UserData.from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UserData.from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Twitter sometimes includes NUL bytes, which might be handled</span>
        <span class="c1"># correctly by sqlalchemy + backend or might not: handling them is</span>
        <span class="c1"># risky. We&#39;ll just drop them to be safe.</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">tweepy_to_json</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">api_response</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\u0000&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> \
                                   <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\00&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\x00&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;screen_name&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">screen_name</span><span class="p">,</span>
            <span class="s1">&#39;create_dt&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
            <span class="s1">&#39;api_response&#39;</span><span class="p">:</span> <span class="n">api_response</span>
        <span class="p">}</span>

        <span class="n">extra_fields</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;protected&#39;</span><span class="p">:</span> <span class="s1">&#39;protected&#39;</span><span class="p">,</span>
            <span class="s1">&#39;verified&#39;</span><span class="p">:</span> <span class="s1">&#39;verified&#39;</span><span class="p">,</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span>
            <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span>
            <span class="s1">&#39;friends_count&#39;</span><span class="p">:</span> <span class="s1">&#39;friends_count&#39;</span><span class="p">,</span>
            <span class="s1">&#39;followers_count&#39;</span><span class="p">:</span> <span class="s1">&#39;followers_count&#39;</span><span class="p">,</span>
            <span class="s1">&#39;listed_count&#39;</span><span class="p">:</span> <span class="s1">&#39;listed_count&#39;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">extra_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
                <span class="n">args</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_user_url</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">Url</span><span class="o">.</span><span class="n">as_unique</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span></div></div>


<div class="viewcode-block" id="Tag"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Tag">[docs]</a><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A tag that can be given to one or more Twitter users.</span>

<span class="sd">    This class represents a tag that can be applied to a set of Twitter users</span>
<span class="sd">    to help track them. Examples might include &quot;treatment A&quot;, &quot;journalists&quot;,</span>
<span class="sd">    &quot;survey_respondents_2020&quot;, etc.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tag_id</span>
<span class="sd">        An autoincrement ID for the tag.</span>

<span class="sd">    name</span>
<span class="sd">        The name of the tag.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">tag_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">users</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">UserTag</span><span class="o">.</span><span class="n">__table__</span><span class="p">,</span>
                         <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;tags&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="List"><a class="viewcode-back" href="../../apidocs.html#twclient.models.List">[docs]</a><span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">FromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A Twitter list of users.</span>

<span class="sd">    Twitter allows users to create lists of other users, and represents these</span>
<span class="sd">    lists as first-class entities in its API. This class represents one of</span>
<span class="sd">    these lists (though not the users in it; see the UserList class for that).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    list_id</span>
<span class="sd">        Twitter&#39;s ID for the list.</span>

<span class="sd">    user_id</span>
<span class="sd">        The Twitter user ID of the user who owns the list.</span>

<span class="sd">    slug</span>
<span class="sd">        The short name of the list (as it appears in, e.g., URLs).</span>

<span class="sd">    api_response</span>
<span class="sd">        The raw json text returned by Twitter.</span>

<span class="sd">    create_dt</span>
<span class="sd">        The date and time the list was created.</span>

<span class="sd">    full_name</span>
<span class="sd">        The list&#39;s &quot;full name&quot;, which is its owning user&#39;s screen name (without</span>
<span class="sd">        the @ sign) and its slug, separated by a slash. For example,</span>
<span class="sd">        &quot;cspan/members-of-congress&quot;.</span>

<span class="sd">    display_name</span>
<span class="sd">        The list&#39;s long-form display name, which may contain spaces and other</span>
<span class="sd">        characters which are not URL-safe.</span>

<span class="sd">    uri</span>
<span class="sd">        A resource URI for this list within the domain of Twitter entities.</span>

<span class="sd">    description</span>
<span class="sd">        A free-form bio/description text for the list.</span>

<span class="sd">    mode</span>
<span class="sd">        Either &quot;public&quot; or &quot;private&quot; depending on the visibility of the list.</span>

<span class="sd">    member_count</span>
<span class="sd">        The number of users on the list as of modified_dt.</span>

<span class="sd">    subscriber_count</span>
<span class="sd">        The number of users who subscribe to a public list (i.e., who have</span>
<span class="sd">        signed up to be able to view the combined timelines of the list</span>
<span class="sd">        members).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># as in Tweet and User, list_id is Twitter&#39;s id rather than a surrogate key</span>
    <span class="n">list_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.user_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># no index needed given unique below</span>

    <span class="n">slug</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">api_response</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">create_dt</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">full_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">member_count</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subscriber_count</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span><span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;slug&#39;</span><span class="p">),)</span>

    <span class="n">owning_user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;lists_owned&#39;</span><span class="p">)</span>
    <span class="n">list_memberships</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;UserList&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;lst&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="List.from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.List.from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># remove NUL bytes as above</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">tweepy_to_json</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">api_response</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\u0000&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> \
                                   <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\00&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\x00&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;list_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;slug&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span>
            <span class="s1">&#39;api_response&#39;</span><span class="p">:</span> <span class="n">api_response</span>
        <span class="p">}</span>

        <span class="n">extra_fields</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;create_dt&#39;</span><span class="p">:</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span>
            <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
            <span class="s1">&#39;uri&#39;</span><span class="p">:</span> <span class="s1">&#39;uri&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span>
            <span class="s1">&#39;member_count&#39;</span><span class="p">:</span> <span class="s1">&#39;member_count&#39;</span><span class="p">,</span>
            <span class="s1">&#39;subscriber_count&#39;</span><span class="p">:</span> <span class="s1">&#39;subscriber_count&#39;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">extra_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
                <span class="n">args</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>

        <span class="c1"># other fields that take special handling</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;full_name&#39;</span><span class="p">):</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">full_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="UserList"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UserList">[docs]</a><span class="k">class</span> <span class="nc">UserList</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    User membership status for Twitter lists.</span>

<span class="sd">    This class represents a user&#39;s membership in a list, and records a user ID</span>
<span class="sd">    and a list ID. The underlying table is in type-2 SCD format, which means</span>
<span class="sd">    that the (user, list) edge is recorded together with the date it was</span>
<span class="sd">    observed (its validity start date). When it ceases to be observed (i.e., is</span>
<span class="sd">    missing on a fetch of the list members), the row is updated to add this</span>
<span class="sd">    validity end date. If the user subsequently returns to the list, a new row</span>
<span class="sd">    is added.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    user_list_id</span>
<span class="sd">        An autoincrement row ID, not assigned by Twitter.</span>

<span class="sd">    user_id</span>
<span class="sd">        The Twitter user ID of the user who is a list member.</span>

<span class="sd">    list_id</span>
<span class="sd">        The Twitter list ID.</span>

<span class="sd">    valid_start_dt</span>
<span class="sd">        The SCD validity start date.</span>

<span class="sd">    valid_end_dt</span>
<span class="sd">        The SCD validity end date (None / NULL if the row is current).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">user_list_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.user_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># no index needed given unique below</span>

    <span class="n">list_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;list.list_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">valid_start_dt</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">valid_end_dt</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;list_id&#39;</span><span class="p">,</span> <span class="s1">&#39;valid_end_dt&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;valid_start_dt&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">lst</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;List&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;list_memberships&#39;</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;list_memberships&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="UserTag"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UserTag">[docs]</a><span class="k">class</span> <span class="nc">UserTag</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Users who have been assigned tags.</span>

<span class="sd">    This table records the assignment of user tags (the Tag class) to users.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    user_tag_id</span>
<span class="sd">        An autoincrement row ID.</span>

<span class="sd">    user_id</span>
<span class="sd">        The Twitter user ID of the user assigned a tag.</span>

<span class="sd">    tag_id</span>
<span class="sd">        The ID of the tag the user is assigned.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">user_tag_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.user_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># no index needed given unique below</span>

    <span class="n">tag_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span>
                    <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tag.tag_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span><span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;tag_id&#39;</span><span class="p">),)</span></div>


<span class="c1">#</span>
<span class="c1"># Follow graph</span>
<span class="c1">#</span>


<div class="viewcode-block" id="Follow"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Follow">[docs]</a><span class="k">class</span> <span class="nc">Follow</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The Twitter follow graph.</span>

<span class="sd">    This class records an edge in the Twitter follow graph. The underlying</span>
<span class="sd">    table stores these edges in a type-2 SCD format, which means that the</span>
<span class="sd">    (source_user, target_user) edge is recorded together with the date it was</span>
<span class="sd">    observed (its validity start date). When it ceases to be observed (i.e., is</span>
<span class="sd">    missing on a fetch where it would be present if still valid), the row is</span>
<span class="sd">    updated to add this validity end date. If the follow relationship is</span>
<span class="sd">    subsequently observed again, a new row is added.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    follow_id</span>
<span class="sd">        An autoincrement row ID, not assigned by Twitter.</span>

<span class="sd">    source_user_id</span>
<span class="sd">        The origin user for the directed follow edge (i.e., a user who follows</span>
<span class="sd">        the user given by target_user_id).</span>

<span class="sd">    target_user_id</span>
<span class="sd">        The destination user for the directed follow edge (i.e., a user who is</span>
<span class="sd">        followed by the user given by source_user_id).</span>

<span class="sd">    valid_start_dt</span>
<span class="sd">        The SCD validity start date.</span>

<span class="sd">    valid_end_dt</span>
<span class="sd">        The SCD validity end date (None / NULL if the row is current).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">follow_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">source_user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                            <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.user_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                            <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">target_user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                            <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.user_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                            <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">valid_start_dt</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">valid_end_dt</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="c1"># NOTE more testing needed to ensure these indexes work as intended</span>

        <span class="c1"># The unique index generated here participates in the INSERT and the</span>
        <span class="c1"># subquery of the UPDATE that load new StgFollow data. When writing the</span>
        <span class="c1"># sort of query that can use it (e.g., get a user&#39;s current followers),</span>
        <span class="c1"># it has the extra benefit of being a covering index.</span>
        <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;source_user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;target_user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;valid_end_dt&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;valid_start_dt&#39;</span><span class="p">),</span>

        <span class="c1"># These are intended to help answer the UPDATE statements issued in</span>
        <span class="c1"># processing new data loaded to StgFollow.</span>
        <span class="n">Index</span><span class="p">(</span><span class="s1">&#39;idx_follow_source_user_id_valid_end_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;source_user_id&#39;</span><span class="p">,</span>
              <span class="s1">&#39;valid_end_dt&#39;</span><span class="p">),</span>
        <span class="n">Index</span><span class="p">(</span><span class="s1">&#39;idx_follow_target_user_id_valid_end_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;target_user_id&#39;</span><span class="p">,</span>
              <span class="s1">&#39;valid_end_dt&#39;</span><span class="p">)</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="StgFollow"><a class="viewcode-back" href="../../apidocs.html#twclient.models.StgFollow">[docs]</a><span class="k">class</span> <span class="nc">StgFollow</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A staging table for the loading of follow-graph edges.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">source_user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">target_user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<span class="c1">#</span>
<span class="c1"># Tweets and tweet entities</span>
<span class="c1">#</span>


<div class="viewcode-block" id="Tweet"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Tweet">[docs]</a><span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">FromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A tweet.</span>

<span class="sd">    This model represents a tweet posted on Twitter and ingested from its API.</span>
<span class="sd">    Several tweet properties are normalized from the raw json into database</span>
<span class="sd">    entities and/or foreign keys.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tweet_id</span>
<span class="sd">        The ID assigned by Twitter to this tweet. These IDs are sequential</span>
<span class="sd">        integers, so that tweets with higher numbers were posted later.</span>

<span class="sd">    user_id</span>
<span class="sd">        The Twitter user ID of the user posting the tweet.</span>

<span class="sd">    retweeted_status_id</span>
<span class="sd">        If this tweet is a retweet of another tweet, the ID of the retweeted</span>
<span class="sd">        tweet. Because Twitter&#39;s API returns the other tweet as well in such</span>
<span class="sd">        cases, this is stored in the database as a foreign key back to the</span>
<span class="sd">        tweet table, helping with graph analysis.</span>

<span class="sd">    quoted_status_id</span>
<span class="sd">        If this tweet is a quote tweet of another tweet, the ID of the quoted</span>
<span class="sd">        tweet. Because Twitter&#39;s API returns the other tweet as well in such</span>
<span class="sd">        cases, this is stored in the database as a foreign key back to</span>
<span class="sd">        the tweet table, helping with graph analysis.</span>

<span class="sd">    api_response</span>
<span class="sd">        The raw json text returned by Twitter.</span>

<span class="sd">    content</span>
<span class="sd">        The body of the tweet. This field may differ from what is observed in</span>
<span class="sd">        the web interface on Twitter.com. In particular, retweets are prepended</span>
<span class="sd">        with &quot;RT @POSTING_USER&quot; and links are rendered with t.co rather than</span>
<span class="sd">        any display URLs.</span>

<span class="sd">    create_dt</span>
<span class="sd">        The date and time the tweet was posted.</span>

<span class="sd">    in_reply_to_status_id</span>
<span class="sd">        If this tweet is a reply, the ID of the tweet it was in reply to. The</span>
<span class="sd">        Twitter API does not return an entity for a replied-to tweet, so this</span>
<span class="sd">        field is not a foreign key (and may reference tweets not in the tweet</span>
<span class="sd">        table).</span>

<span class="sd">    in_reply_to_user_id</span>
<span class="sd">        If this tweet is a reply, the ID of the user who posted the tweet it</span>
<span class="sd">        was in reply to. The Twitter API does not return an entity for a</span>
<span class="sd">        replied-to tweet, so this field is not a foreign key (and may refer to</span>
<span class="sd">        users not in the user table).</span>

<span class="sd">    lang</span>
<span class="sd">        The detected language of the tweet.</span>

<span class="sd">    source</span>
<span class="sd">        The platform from which the tweet was posted (iPhone, Android, desktop,</span>
<span class="sd">        etc).</span>

<span class="sd">    truncated</span>
<span class="sd">        Was the tweet text truncated at 140 characters? Should always be false,</span>
<span class="sd">        included for visibility.</span>

<span class="sd">    retweet_count</span>
<span class="sd">        The number of times this tweet was retweeted.</span>

<span class="sd">    favorite_count</span>
<span class="sd">        The number of times this tweet was favorited / liked.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># as in User, this is the Twitter id rather than a surrogate key</span>
    <span class="n">tweet_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.user_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">retweeted_status_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                                 <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tweet.tweet_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                                 <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">quoted_status_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                              <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tweet.tweet_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                              <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">api_response</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">create_dt</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># we don&#39;t get this back on the Twitter API response, can&#39;t assume the</span>
    <span class="c1"># corresponding tweet row is present in this table</span>
    <span class="n">in_reply_to_status_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">in_reply_to_user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">lang</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">truncated</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">retweet_count</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">favorite_count</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">user_id</span><span class="p">],</span>
                        <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;tweets&#39;</span><span class="p">)</span>

    <span class="n">retweet_of</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">retweeted_status_id</span><span class="p">],</span>
                              <span class="n">remote_side</span><span class="o">=</span><span class="p">[</span><span class="n">tweet_id</span><span class="p">])</span>
    <span class="n">quote_of</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">quoted_status_id</span><span class="p">],</span>
                            <span class="n">remote_side</span><span class="o">=</span><span class="p">[</span><span class="n">tweet_id</span><span class="p">])</span>

    <span class="n">user_mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;UserMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span>
                                 <span class="n">cascade</span><span class="o">=</span><span class="s1">&#39;all, delete-orphan&#39;</span><span class="p">)</span>
    <span class="n">hashtag_mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;HashtagMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span>
                                    <span class="n">cascade</span><span class="o">=</span><span class="s1">&#39;all, delete-orphan&#39;</span><span class="p">)</span>
    <span class="n">symbol_mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;SymbolMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span>
                                   <span class="n">cascade</span><span class="o">=</span><span class="s1">&#39;all, delete-orphan&#39;</span><span class="p">)</span>
    <span class="n">url_mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;UrlMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span>
                                <span class="n">cascade</span><span class="o">=</span><span class="s1">&#39;all, delete-orphan&#39;</span><span class="p">)</span>
    <span class="n">media_mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;MediaMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span>
                                  <span class="n">cascade</span><span class="o">=</span><span class="s1">&#39;all, delete-orphan&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Tweet.from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Tweet.from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># remove NUL bytes as above</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">tweepy_to_json</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">api_response</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\u0000&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> \
                                   <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\00&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\x00&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;tweet_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;create_dt&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
            <span class="s1">&#39;api_response&#39;</span><span class="p">:</span> <span class="n">api_response</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;full_text&#39;</span><span class="p">):</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">full_text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">text</span>

        <span class="n">extra_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;in_reply_to_status_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;in_reply_to_user_id&#39;</span><span class="p">,</span>

            <span class="s1">&#39;lang&#39;</span><span class="p">,</span>
            <span class="s1">&#39;source&#39;</span><span class="p">,</span>
            <span class="s1">&#39;truncated&#39;</span><span class="p">,</span>
            <span class="s1">&#39;retweet_count&#39;</span><span class="p">,</span>
            <span class="s1">&#39;favorite_count&#39;</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">extra_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">args</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="s1">&#39;null&#39;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

        <span class="n">ret</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">from_tweepy</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>

        <span class="c1"># NOTE We&#39;ve decided not to use this data. There&#39;s too much</span>
        <span class="c1"># of it and it doesn&#39;t add enough value for the amount of space</span>
        <span class="c1"># it takes up (relative to just the explicit fetches via UserInfoJob).</span>
        <span class="c1"># Implementing SCD on this table would also be too much work, and</span>
        <span class="c1"># given that the followers/friends/listed counts change rapidly, would</span>
        <span class="c1"># still take up too much space.</span>
        <span class="c1"># ret.user.data.append(UserData.from_tweepy(obj.user, session))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;quoted_status&#39;</span><span class="p">):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">quote_of</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">from_tweepy</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">quoted_status</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;retweeted_status&#39;</span><span class="p">):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">retweet_of</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">from_tweepy</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">retweeted_status</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>

        <span class="n">ret</span><span class="o">.</span><span class="n">user_mentions</span> <span class="o">=</span> <span class="n">UserMention</span><span class="o">.</span><span class="n">list_from_tweepy</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">hashtag_mentions</span> <span class="o">=</span> <span class="n">HashtagMention</span><span class="o">.</span><span class="n">list_from_tweepy</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">symbol_mentions</span> <span class="o">=</span> <span class="n">SymbolMention</span><span class="o">.</span><span class="n">list_from_tweepy</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">url_mentions</span> <span class="o">=</span> <span class="n">UrlMention</span><span class="o">.</span><span class="n">list_from_tweepy</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">media_mentions</span> <span class="o">=</span> <span class="n">MediaMention</span><span class="o">.</span><span class="n">list_from_tweepy</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span></div></div>


<div class="viewcode-block" id="Hashtag"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Hashtag">[docs]</a><span class="k">class</span> <span class="nc">Hashtag</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">UniqueMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A hashtag.</span>

<span class="sd">    This class represents a hashtag used in a tweet. Hashtags are stored</span>
<span class="sd">    without their &#39;#&#39; prefix.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    hashtag_id</span>
<span class="sd">        An autoincrement row ID, not assigned by Twitter.</span>

<span class="sd">    name</span>
<span class="sd">        The text of the hashtag.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">hashtag_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;HashtagMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;hashtag&#39;</span><span class="p">,</span>
                            <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Symbol"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Symbol">[docs]</a><span class="k">class</span> <span class="nc">Symbol</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">UniqueMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A ticker symbol as detected by Twitter.</span>

<span class="sd">    Twitter attempts to detect stock-ticker symbols when prefixed with a &#39;$&#39; (a</span>
<span class="sd">    &quot;cashtag&quot;) and make them searchable on its service. The detection is crude</span>
<span class="sd">    and based on regular expressions, with no attempt to ensure the detected</span>
<span class="sd">    symbols are real ticker symbols. Such cashtags are represented by this</span>
<span class="sd">    class, stored without their leading &#39;$&#39;.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    symbol_id</span>
<span class="sd">        An autoincrement row ID, not assigned by Twitter.</span>

<span class="sd">    name</span>
<span class="sd">        The text of the symbol / cashtag.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">symbol_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;SymbolMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span>
                            <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Url"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Url">[docs]</a><span class="k">class</span> <span class="nc">Url</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">UniqueMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A URL.</span>

<span class="sd">    This class represents a unique URL that appeared somewhere on Twitter. URLs</span>
<span class="sd">    are represented as a separate entity rather than multiple text fields to</span>
<span class="sd">    make it easier to track them across the many places they may appear.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    url_id</span>
<span class="sd">        An autoincrement row ID, not assigned by Twitter.</span>

<span class="sd">    url</span>
<span class="sd">        The URL itself.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">url_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;UrlMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">,</span>
                            <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;UserData&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">,</span>
                             <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">media</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Media&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">,</span>
                         <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">media_variants</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;MediaVariant&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">,</span>
                                  <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="MediaType"><a class="viewcode-back" href="../../apidocs.html#twclient.models.MediaType">[docs]</a><span class="k">class</span> <span class="nc">MediaType</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">UniqueMixin</span><span class="p">,</span> <span class="n">FromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The type of a media object in a tweet.</span>

<span class="sd">    Media objects in tweets can have several types: photo, video, and others.</span>
<span class="sd">    This table tracks the observed types of media.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    media_type_id</span>
<span class="sd">        An autoincrement row ID, not assigned by Twitter.</span>

<span class="sd">    name</span>
<span class="sd">        Twitter&#39;s name for this type of media.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">media_type_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">media</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Media&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;media_type&#39;</span><span class="p">,</span>
                         <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="MediaType.from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.MediaType.from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">media_type</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;additional_media_info&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;embeddable&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;additional_media_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;additional_media_info&#39;</span><span class="p">][</span><span class="s1">&#39;embeddable&#39;</span><span class="p">]:</span>
                    <span class="n">media_type</span> <span class="o">=</span> <span class="s1">&#39;unembeddable_video&#39;</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">as_unique</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">media_type</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Media"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Media">[docs]</a><span class="k">class</span> <span class="nc">Media</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">FromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A media object on Twitter.</span>

<span class="sd">    This class represents media objects like photos and videos which occur in</span>
<span class="sd">    tweets. The media&#39;s type and primary URL are recorded here. Note though</span>
<span class="sd">    that for videos the &quot;primary&quot; URL is a thumbnail still; see the</span>
<span class="sd">    MediaVariant class for the various video files actually available.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    media_id</span>
<span class="sd">        Twitter&#39;s ID for this media.</span>

<span class="sd">    media_type_id</span>
<span class="sd">        The type of media.</span>

<span class="sd">    media_url_id</span>
<span class="sd">        The primary URL of the media. For videos, this URL is a thumbnail still</span>
<span class="sd">        and the video files themselves are recorded in the MediaVariant class.</span>

<span class="sd">    aspect_ratio_width</span>
<span class="sd">        For videos, the first number of the video&#39;s aspect ratio (e.g., &quot;16&quot;</span>
<span class="sd">        for a &quot;16:9&quot; aspect ratio). None / NULL otherwise.</span>

<span class="sd">    aspect_ratio_height</span>
<span class="sd">        For videos, the second number of the video&#39;s aspect ratio (e.g., &quot;9&quot;</span>
<span class="sd">        for a &quot;16:9&quot; aspect ratio). None / NULL otherwise.</span>

<span class="sd">    duration</span>
<span class="sd">        For videos, the duration of the video in seconds. None / NULL</span>
<span class="sd">        otherwise.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Twitter gives these IDs, so unlike with the other entities we don&#39;t have</span>
    <span class="c1"># to make one up</span>
    <span class="n">media_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">media_type_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span>
                           <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;media_type.media_type_id&#39;</span><span class="p">,</span>
                                      <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                           <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">media_url_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                          <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;url.url_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                          <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># video-specific attributes</span>
    <span class="n">aspect_ratio_width</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">aspect_ratio_height</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">media_type</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;MediaType&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;media&#39;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Url&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;media&#39;</span><span class="p">)</span>
    <span class="n">variants</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;MediaVariant&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;media&#39;</span><span class="p">,</span>
                            <span class="n">cascade</span><span class="o">=</span><span class="s1">&#39;all, delete-orphan&#39;</span><span class="p">)</span>
    <span class="n">mentions</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;MediaMention&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;media&#39;</span><span class="p">,</span>
                            <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="Media.from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.Media.from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;media_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Info that&#39;s only populated for videos</span>
        <span class="k">if</span> <span class="s1">&#39;video_info&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;duration_millis&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;video_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;video_info&#39;</span><span class="p">][</span><span class="s1">&#39;duration_millis&#39;</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">duration</span>

            <span class="k">if</span> <span class="s1">&#39;aspect_ratio&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;video_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;video_info&#39;</span><span class="p">][</span><span class="s1">&#39;aspect_ratio&#39;</span><span class="p">]</span>

                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;aspect_ratio_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">width</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;aspect_ratio_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">height</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MediaVariant"><a class="viewcode-back" href="../../apidocs.html#twclient.models.MediaVariant">[docs]</a><span class="k">class</span> <span class="nc">MediaVariant</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">ListFromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Specific video files for a Twitter video, which may have more than one.</span>

<span class="sd">    Twitter video media may have multiple specific video files associated with</span>
<span class="sd">    them, providing different bitrates, file formats or other properties. Each</span>
<span class="sd">    such video file is a MediaVariant.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    media_id</span>
<span class="sd">        The Twitter media entity this video file is associated with.</span>

<span class="sd">    url_id</span>
<span class="sd">        The URL of the video file.</span>

<span class="sd">    bitrate</span>
<span class="sd">        The bitrate of the video file.</span>

<span class="sd">    content_type</span>
<span class="sd">        The MIME type of the video.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">media_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                      <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;media.media_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">url_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                    <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;url.url_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">bitrate</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Url&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;media_variants&#39;</span><span class="p">)</span>
    <span class="n">media</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Media&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;variants&#39;</span><span class="p">,</span>
                         <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="MediaVariant.list_from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.MediaVariant.list_from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s1">&#39;video_info&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">if</span> <span class="s1">&#39;variants&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;video_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;video_info&#39;</span><span class="p">][</span><span class="s1">&#39;variants&#39;</span><span class="p">]:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;media_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="s1">&#39;bitrate&#39;</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span><span class="p">[</span><span class="s1">&#39;bitrate&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;content_type&#39;</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span><span class="p">[</span><span class="s1">&#39;content_type&#39;</span><span class="p">]</span>

            <span class="n">variant</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">variant</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">Url</span><span class="o">.</span><span class="n">as_unique</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">entity</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>

            <span class="n">ret</span> <span class="o">+=</span> <span class="p">[</span><span class="n">variant</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ret</span></div></div>


<div class="viewcode-block" id="UserMention"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UserMention">[docs]</a><span class="k">class</span> <span class="nc">UserMention</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">ListFromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A mention of a user in a tweet.</span>

<span class="sd">    This class represents a mention of a user in a tweet. There can be multiple</span>
<span class="sd">    mentions of the same user in the same tweet, so we also record the position</span>
<span class="sd">    in the tweet where the mention occurred.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tweet_id</span>
<span class="sd">        Twitter&#39;s ID for the tweet.</span>

<span class="sd">    start_index</span>
<span class="sd">        The index in the tweet content of the first character of this mention.</span>

<span class="sd">    end_index</span>
<span class="sd">        The index in the tweet content of the last character of this mention.</span>

<span class="sd">    mentioned_user_id</span>
<span class="sd">        The Twitter user ID of the user who was mentioned.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">tweet_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                      <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tweet.tweet_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">start_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">mentioned_user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                               <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.user_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                               <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;mentions&#39;</span><span class="p">)</span>
    <span class="n">tweet</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;tweet_id&#39;</span><span class="p">,</span> <span class="s1">&#39;start_index&#39;</span><span class="p">,</span> <span class="s1">&#39;end_index&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="UserMention.list_from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UserMention.list_from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;entities&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;user_mentions&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">mtn</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s1">&#39;user_mentions&#39;</span><span class="p">]:</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;tweet_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="s1">&#39;start_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;end_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">}</span>

                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

                    <span class="n">lst</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ret</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">lst</span></div></div>


<div class="viewcode-block" id="HashtagMention"><a class="viewcode-back" href="../../apidocs.html#twclient.models.HashtagMention">[docs]</a><span class="k">class</span> <span class="nc">HashtagMention</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">ListFromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A mention of a hashtag in a tweet.</span>

<span class="sd">    This class represents a mention of a hashtag in a tweet. There can be</span>
<span class="sd">    multiple mentions of the same hashtag in the same tweet, so we also record</span>
<span class="sd">    the position in the tweet where the mention occurred.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tweet_id</span>
<span class="sd">        Twitter&#39;s ID for the tweet.</span>

<span class="sd">    start_index</span>
<span class="sd">        The index in the tweet content of the first character of this mention.</span>

<span class="sd">    end_index</span>
<span class="sd">        The index in the tweet content of the last character of this mention.</span>

<span class="sd">    hashtag_id</span>
<span class="sd">        The (non-Twitter) ID of the hashtag that was mentioned.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">tweet_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                      <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tweet.tweet_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">start_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">hashtag_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                        <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;hashtag.hashtag_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">hashtag</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Hashtag&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;mentions&#39;</span><span class="p">)</span>
    <span class="n">tweet</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;hashtag_mentions&#39;</span><span class="p">,</span>
                         <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;tweet_id&#39;</span><span class="p">,</span> <span class="s1">&#39;start_index&#39;</span><span class="p">,</span> <span class="s1">&#39;end_index&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="HashtagMention.list_from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.HashtagMention.list_from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;entities&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;hashtags&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">mtn</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s1">&#39;hashtags&#39;</span><span class="p">]:</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;tweet_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="s1">&#39;start_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;end_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">}</span>

                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">hashtag</span> <span class="o">=</span> <span class="n">Hashtag</span><span class="o">.</span><span class="n">as_unique</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>

                    <span class="n">lst</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ret</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">lst</span></div></div>


<div class="viewcode-block" id="SymbolMention"><a class="viewcode-back" href="../../apidocs.html#twclient.models.SymbolMention">[docs]</a><span class="k">class</span> <span class="nc">SymbolMention</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">ListFromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A mention of a ticker symbol (&quot;cashtag&quot;) in a tweet.</span>

<span class="sd">    This class represents a mention of a ticker symbol in a tweet. There can be</span>
<span class="sd">    multiple mentions of the same symbol in the same tweet, so we also record</span>
<span class="sd">    the position in the tweet where the mention occurred.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tweet_id</span>
<span class="sd">        Twitter&#39;s ID for the tweet.</span>

<span class="sd">    start_index</span>
<span class="sd">        The index in the tweet content of the first character of this mention.</span>

<span class="sd">    end_index</span>
<span class="sd">        The index in the tweet content of the last character of this mention.</span>

<span class="sd">    symbol_id</span>
<span class="sd">        The (non-Twitter) ID of the symbol that was mentioned.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">tweet_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                      <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tweet.tweet_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">start_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">symbol_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                       <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;symbol.symbol_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                       <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">symbol</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Symbol&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;mentions&#39;</span><span class="p">)</span>
    <span class="n">tweet</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;symbol_mentions&#39;</span><span class="p">,</span>
                         <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;tweet_id&#39;</span><span class="p">,</span> <span class="s1">&#39;start_index&#39;</span><span class="p">,</span> <span class="s1">&#39;end_index&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="SymbolMention.list_from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.SymbolMention.list_from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;entities&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;symbols&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">mtn</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s1">&#39;symbols&#39;</span><span class="p">]:</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;tweet_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="s1">&#39;start_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;end_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">}</span>

                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">Symbol</span><span class="o">.</span><span class="n">as_unique</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span>

                    <span class="n">lst</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ret</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">lst</span></div></div>


<div class="viewcode-block" id="UrlMention"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UrlMention">[docs]</a><span class="k">class</span> <span class="nc">UrlMention</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">ListFromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A mention of a URL in a tweet.</span>

<span class="sd">    This class represents a mention of a URL in a tweet. There can be</span>
<span class="sd">    multiple mentions of the same URL in the same tweet, so we also record</span>
<span class="sd">    the position in the tweet where the mention occurred. Some attributes of</span>
<span class="sd">    the URL mention itself, in addition to the URL, are also tracked here.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tweet_id</span>
<span class="sd">        Twitter&#39;s ID for the tweet.</span>

<span class="sd">    start_index</span>
<span class="sd">        The index in the tweet content of the first character of this mention.</span>

<span class="sd">    end_index</span>
<span class="sd">        The index in the tweet content of the last character of this mention.</span>

<span class="sd">    url_id</span>
<span class="sd">        The (non-Twitter) ID of the URL that was mentioned.</span>

<span class="sd">    twitter_short_url</span>
<span class="sd">        The t.co link that appears in the tweet body.</span>

<span class="sd">    twitter_display_url</span>
<span class="sd">        The display URL Twitter shows on its smartphone apps and desktop</span>
<span class="sd">        website.</span>

<span class="sd">    expanded_short_url</span>
<span class="sd">        If the user inputs an already shortened URL (e.g., bit.ly), Twitter</span>
<span class="sd">        resolves the URL further to a final page. In this case, we store the</span>
<span class="sd">        original short URL that the user entered here and use the resolved page</span>
<span class="sd">        as the main mentioned URL.</span>

<span class="sd">    status</span>
<span class="sd">        If a shortened URL input by a user was resolved further, the HTTP</span>
<span class="sd">        status code of the final GET request in the chain. None / NULL</span>
<span class="sd">        otherwise.</span>

<span class="sd">    title</span>
<span class="sd">        If a shortened URL input by a user was resolved further, the title of</span>
<span class="sd">        the fetched page. None / NULL otherwise.</span>

<span class="sd">    description</span>
<span class="sd">        If a shortened URL input by a user was resolved further, the value of</span>
<span class="sd">        the description meta tag for the fetched page. None / NULL otherwise.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">tweet_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                      <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tweet.tweet_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">start_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">url_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                    <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;url.url_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># These are properties of the specific URL mention, not the page at the</span>
    <span class="c1"># other end</span>
    <span class="n">twitter_short_url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">twitter_display_url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">expanded_short_url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># It&#39;s less obvious, but these are also properties of the URL mention, not</span>
    <span class="c1"># the URL itself, because they have a time dimension. (The page behind the</span>
    <span class="c1"># URL can change over time.)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Url&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;mentions&#39;</span><span class="p">)</span>
    <span class="n">tweet</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;url_mentions&#39;</span><span class="p">,</span>
                         <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;tweet_id&#39;</span><span class="p">,</span> <span class="s1">&#39;start_index&#39;</span><span class="p">,</span> <span class="s1">&#39;end_index&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="UrlMention.list_from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.UrlMention.list_from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;entities&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;urls&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">mtn</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;tweet_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="s1">&#39;start_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;end_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">mtn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;twitter_short_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="s1">&#39;display_url&#39;</span> <span class="ow">in</span> <span class="n">mtn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;twitter_display_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;display_url&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="s1">&#39;unwound&#39;</span> <span class="ow">in</span> <span class="n">mtn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;unwound&#39;</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;unwound&#39;</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;unwound&#39;</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>

                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;expanded_short_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;expanded_url&#39;</span><span class="p">]</span>
                        <span class="n">url</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;unwound&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">url</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;expanded_url&#39;</span><span class="p">]</span>

                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">Url</span><span class="o">.</span><span class="n">as_unique</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

                    <span class="n">lst</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ret</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">lst</span></div></div>


<div class="viewcode-block" id="MediaMention"><a class="viewcode-back" href="../../apidocs.html#twclient.models.MediaMention">[docs]</a><span class="k">class</span> <span class="nc">MediaMention</span><span class="p">(</span><span class="n">TimestampsMixin</span><span class="p">,</span> <span class="n">ListFromTweepyInterface</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A mention of a media object in a tweet.</span>

<span class="sd">    This class represents a mention of a media object like a photo or video in</span>
<span class="sd">    a tweet. There can be multiple mentions of the same media in the same</span>
<span class="sd">    tweet, so we also record the position in the tweet where the mention</span>
<span class="sd">    occurred. Some attributes of the media mention itself, in addition to the</span>
<span class="sd">    URL, are also tracked here.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tweet_id</span>
<span class="sd">        Twitter&#39;s ID for the tweet.</span>

<span class="sd">    start_index</span>
<span class="sd">        The index in the tweet content of the first character of this mention.</span>

<span class="sd">    end_index</span>
<span class="sd">        The index in the tweet content of the last character of this mention.</span>

<span class="sd">    media_id</span>
<span class="sd">        Twitter&#39;s ID for the media that was mentioned.</span>

<span class="sd">    twitter_short_url</span>
<span class="sd">        The t.co link that appears in the tweet body.</span>

<span class="sd">    twitter_display_url</span>
<span class="sd">        The display URL Twitter shows on its smartphone apps and desktop</span>
<span class="sd">        website.</span>

<span class="sd">    twitter_expanded_url</span>
<span class="sd">        The URL for the usual Twitter web viewer for this media, which one</span>
<span class="sd">        would encounter after clicking on it from Twitter.com.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">tweet_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                      <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tweet.tweet_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">start_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_index</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autoincrement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">media_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">,</span>
                      <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;media.media_id&#39;</span><span class="p">,</span> <span class="n">deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># (Probably) properties of the specific media mention, not the media itself</span>
    <span class="n">twitter_short_url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">twitter_display_url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">twitter_expanded_url</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">media</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Media&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;mentions&#39;</span><span class="p">)</span>
    <span class="n">tweet</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s1">&#39;media_mentions&#39;</span><span class="p">,</span>
                         <span class="n">cascade_backrefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;tweet_id&#39;</span><span class="p">,</span> <span class="s1">&#39;start_index&#39;</span><span class="p">,</span> <span class="s1">&#39;end_index&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="MediaMention.list_from_tweepy"><a class="viewcode-back" href="../../apidocs.html#twclient.models.MediaMention.list_from_tweepy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_tweepy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># the usual entities object provides incorrect information for media</span>
        <span class="c1"># entities; see Twitter&#39;s docs for the &quot;extended entities&quot; object</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;extended_entities&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lst</span>

        <span class="k">if</span> <span class="s1">&#39;media&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">lst</span>

        <span class="k">for</span> <span class="n">mtn</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">extended_entities</span><span class="p">[</span><span class="s1">&#39;media&#39;</span><span class="p">]:</span>
            <span class="c1">#</span>
            <span class="c1"># The MediaMention object</span>
            <span class="c1">#</span>

            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;tweet_id&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;start_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="s1">&#39;end_index&#39;</span><span class="p">:</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">mtn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;twitter_short_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;display_url&#39;</span> <span class="ow">in</span> <span class="n">mtn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;twitter_display_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;display_url&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;expanded_url&#39;</span> <span class="ow">in</span> <span class="n">mtn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;twitter_expanded_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;expanded_url&#39;</span><span class="p">]</span>

            <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">ret</span><span class="o">.</span><span class="n">media</span> <span class="o">=</span> <span class="n">Media</span><span class="o">.</span><span class="n">from_tweepy</span><span class="p">(</span><span class="n">mtn</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">from_tweepy</span><span class="p">(</span><span class="n">mtn</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;media_url_https&#39;</span> <span class="ow">in</span> <span class="n">mtn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">media_url</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;media_url_https&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">media_url</span> <span class="o">=</span> <span class="n">mtn</span><span class="p">[</span><span class="s1">&#39;media_url&#39;</span><span class="p">]</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">Url</span><span class="o">.</span><span class="n">as_unique</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">media_url</span><span class="p">)</span>

            <span class="c1"># &quot;Variants&quot; aka video files (multiple encodings per Media)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">media</span><span class="o">.</span><span class="n">variants</span> <span class="o">=</span> <span class="n">MediaVariant</span><span class="o">.</span><span class="n">list_from_tweepy</span><span class="p">(</span><span class="n">mtn</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>

            <span class="n">lst</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ret</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">lst</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2021, Massachusetts Institute of Technology.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>